# 常见问题
[三种负载均衡类型，如何选择使用哪一种](FAQ#user-content-1)

[添加转发规则组(转发、重定向)](FAQ#user-content-2)

[管理转发规则组](FAQ#user-content-3)

**Q：三种负载均衡类型，如何选择使用哪一种？**
<div id="user-content-1"></div>

A：在满足用户需求的同时，建议按照如下流程选择负载均衡类型，以使用户获得最好的性能体验及花费最少。
![LB类型选择](../../../../image/Networking/ALB/ALB-faq.png)

**Q：应用负载均衡无法与后端服务器实例进行通信？**

A：后端云主机/容器实例的安全组、ACL必须显示的允许应用负载均衡和服务器实例之间的通信，注意ACL为无状态规则，需要分别配置流入、流出应用负载均衡的策略。

**Q：应用负载均衡HTTP/HTTPS协议下监听无法获取客户端真实IP？**

A：应用负载均衡默认支持HTTP/HTTPS协议下获取客户端真实IP，需用户在web server中进行相应的配置。

以nginx为例：需要安装http_realip module，并在nginx.conf中添加以下两行配置项：

set_real_ip_from 应用负载均衡所在子网IP段

real_ip_header X-Forwarded-For

![nginx XFF配置](https://github.com/jdcloudcom/cn/blob/master/image/Networking/ALB/ALB-010.png)

**Q：多可用区是怎样保障高可用的？**

A：只能将应用负载均衡所在可用区内的云主机/容器添加为后端服务，按照设置的调度算法进行流量转发，当一个可用区出现故障时，流量将自动切换至其他可用区服务器。


**Q：应用负载均衡后端服务如何选择关联虚拟服务器组还是高可用组？**

A：虚拟服务器组可以由用户手动或者通过与AS关联自动增删云主机实例，手动配置方式使用简单；虚拟服务器组可以与AS（弹性伸缩）关联使用，实现跨可用区的高可用，但不保证同可用区内跨机架的高可用。高可用组自动实现了主机实例跨AZ、跨机架的高可用分配与按照规则弹性伸缩，提供比虚拟服务器组更灵活、更自动的主机分配服务。因此用户需要简单使用、快速上手时，可选择关联虚拟服务器组；用户需要自动的高可用服务，建议选择关联高可用组。


**Q：一个应用负载均衡实例占用的内网ip资源？**

A：应用负载均衡在每个可用区采用高可用架构，默认启用两个实例资源，除去vip还需要占用两个所在子网的ip资源，因此单可用区一共会占用3个内网ip，双可用区会占用5个内网ip，每多支持一个可用区需多占用两个所在子网的ip资源，以此类推。

**Q：使用转发规则组时，为什么应用负载均衡会对某些请求的URL进行重定向？**

A：当应用负载均衡配置的转发规则的URL路径以'/'结尾，并且相同域名下未配置另外一条相同URL路径前缀但没有'/'的转发规则时，应用负载均衡会对访问没有'/'的URL路径前缀的请求执行301重定向，返回带'/'的URL请求，以实现带'/'和不带'/'的访问请求都可以被应用负载均衡兼容转发。

举例1：应用负载均衡配置了转发规则1(域名:aaa. bbb. com ，URL路径：/path1/abc/或/path/abc/\*，后端服务：backend)，未配置转发规则2(域名：aaa. bbb. com ，URL 路径： /path/abc，后端服务：backend)。用户访问 http:// aaa. bbb . com/path1/abc ，应用负载均衡收到访问请求时，会执行301重定向返回http:// aaa. bbb. com/path1/abc/ ，访问流量将匹配转发规则1分发给backend处理。

如用户不想应用负载均衡执行301重定向，可配置转发规则2（域名：aaa. bbb. com ，URL路径：/path1/abc，后端服务：backend），通过该转发规则明确指定访问请求http:// aaa. bbb. com/path1/abc 的转发行为。

