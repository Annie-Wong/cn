# 从NAT实例向NAT网关迁移
如果您已经在VPC中基于云主机搭建了NAT实例实现SNAT，想将架构切换为完全托管的NAT网关产品。基于您迁移后是否需要修改出公网IP地址，提供如下两套迁移方案：

[迁移后修改公网IP](Migration-From-Instance-To-Nat-Gateway#user-content-1)

[迁移后不修改公网IP](Migration-From-Instance-To-Nat-Gateway#user-content-2)

注：

       1. 迁移瞬间，已有的TCP连接会中断，应用重新连接即可恢复，新建连接不受影响

       2. 如果用户使用多个NAT实例，可以根据实际流量和连接数情况，考虑用一个或多个NAT网关替换

## 迁移后修改公网IP
<div id="user-content-1"></div>

NAT实例绑定的公网IP没有被其他业务配置白名单规则或已经调整规则，修改公网IP后，不影响出公网业务访问。该情况建议:

1. 新建一个NAT网关：在NAT实例所在子网创建一个NAT网关

2. 将内部云主机子网路由的下一跳由NAT实例切换为NAT网关：编辑原有指向NAT实例的路由表，假设路由表已经存在一个路由表项：目的地址为0.0.0.0/0，下一跳类型为云主机，下一跳地址为NAT实例所在云主机；修改此路由表项为：目的地址0.0.0.0/0不变,下一跳类型修改为NAT网关，下一跳选择最新创建的NAT网关，保存配置，原来通过NAT实例访问公网的流量就切换到NAT网关

## 迁移后不修改公网IP
<div id="user-content-2"></div>

NAT实例绑定的公网IP已被其他业务配置白名单规则，且原有架构中配置了多台NAT实例以等价路由的形式提供高可用。该情况建议：

1. 删除备用NAT实例，保留备用NAT实例绑定的公网IP

2. 使用备用NAT实例的公网IP创建NAT网关。即在NAT实例所在子网创建一个NAT网关，公网IP选择原备用NAT实例的公网IP

3. 在内部云主机所在的VPC内新建一个路由表routeTable1，路由与内部云主机现有子网路由表一致，仅修改出公网下一跳类型为NAT网关，下一跳为新创建的NAT网关

4. 切换内部云主机子网绑定的路由表为routeTable1，原来访问NAT实例的流量就切换到了NAT网关

5. 按照步骤一和步骤二，删除剩余的NAT实例，使用其公网IP地址创建NAT网关，增加一条或多条出公网路由，下一跳指向创建的NAT网关，形成出公网等价路由，提供高可用
